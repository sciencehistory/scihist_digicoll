namespace :scihist do
  namespace :data_fixes do
    desc """
      Set ocr_requested to true for a new batch of works (june 2024)
      rake scihist:data_fixes:set_ocr_requested_june_2024

      Do just one:
      rake scihist:data_fixes:set_ocr_requested_june_2024['aso1ecq']
    """
    task :set_ocr_requested_june_2024, [:work_friendlier_id] => :environment do |t, args|

      items_needing_ocr = [
        '00000059p',
        '10el2db',
        '1abq6cv',
        '1ndf3hf',
        '1v53jx89f',
        '1x93vdg',
        '1z40kt41h',
        '1zshph4',
        '20kxw7k',
        '25dyk6p',
        '27mo804',
        '2z10wr23f',
        '37720d24n',
        '3dbh0ng',
        '3dc72as',
        '3j333301b',
        '3j3333398',
        '3n203z173',
        '3nz58ef',
        '3r074v594',
        '41687j69c',
        '46smfc1',
        '4b29b690d',
        '4dcl1aq',
        '4hml3f5',
        '4qlor3l',
        '4w5cwnu',
        '4x51hj81r',
        '50cnjm9',
        '58s4wy3',
        '5999n455n',
        '5999n456x',
        '5h73pw14h',
        '5l15b5i',
        '5m60qs97h',
        '5sgmjgh',
        '5w3x3vu',
        '6108vb34k',
        '6d56zx16p',
        '6hz4gzn',
        '6t053h17b',
        '6w924c48b',
        '73x6up6',
        '7fmih3e',
        '7g7sykv',
        '7hlt38t',
        '7kssjdm',
        '7p05mi5',
        '7r9fbhw',
        '7ucpb1m',
        '7uk1dod',
        '7w62f955m',
        '8910jv725',
        '8c97kq63g',
        '8g84mm76s',
        '8lelsrz',
        '8r00347',
        '8vd3kbc',
        '9306sz691',
        '9880vr88p',
        '9ag3q0u',
        '9c67wn74v',
        '9chrkef',
        '9hu7g0h',
        '9k41zd82t',
        '9s161738c',
        '9w0323862',
        'a25w764',
        'actytlk',
        'ak8mcz4',
        'akxmjsq',
        'aso1ecq',
        'asx7t5o',
        'awm78yy',
        'b2773w23c',
        'bg257g44c',
        'bgd84t5',
        'blz0d1e',
        'brpy6h2',
        'by8cen9',
        'bzbzq6p',
        'c26dktp',
        'c5hekt0',
        'c5ri8xu',
        'c73lqd6',
        'c7jixao',
        'cf1g27k',
        'cn69m481p',
        'cnlv4q9',
        'dh8qks4',
        'dnel7ah',
        'dq1vcry',
        'drkkqip',
        'dwh6udb',
        'dxxyzo5',
        'dzskowv',
        'ej5g6p0',
        'f1881n22k',
        'f3vunv2',
        'fb494960s',
        'fc9f8sh',
        'fhiw36j',
        'fk7gfc7',
        'g4f4xrr',
        'gh93h0704',
        'gt54kn070',
        'guxwfm4',
        'gx41mk00h',
        'gzh9c7d',
        'h128nf12n',
        'h2wpjqz',
        'h415pb65x',
        'h702q750j',
        'hcxstvh',
        'hd76s099h',
        'hh63sw38v',
        'hhohjvz',
        'hm50ts226',
        'hm50ts49m',
        'hmo12zt',
        'hnaq4i6',
        'hqr0vep',
        'i3ntrqa',
        'if1y8jh',
        'ip5xqsz',
        'iqir275',
        'j098zb837',
        'j7eqggo',
        'j965jda',
        'jd472x647',
        'jq085m03h',
        'jswrvtg',
        'juzgqqv',
        'jxn9x1v',
        'k06988730',
        'k4424ph',
        'kh04dq16g',
        'kjzq5sx',
        'kw52j813n',
        'kw52j944v',
        'lfk1l7p',
        'li2hswd',
        'liut8yp',
        'm039k620t',
        'm326m2699',
        'mkicy9w',
        'mkmg3gr',
        'ml2d1fx',
        'ms35t945j',
        'ms35t9537',
        'mw22v6127',
        'ng451j669',
        'nk61zfx',
        'nlp95ls',
        'no6jc8u',
        'nqee13h',
        'oevh9ff',
        'ohfepv5',
        'oxczuzg',
        'p8xwtv7',
        'pg6ay55',
        'pk02cb51k',
        'pn89d780h',
        'ppze54g',
        'pr8v5c1',
        'px4ksww',
        'q811kk83q',
        'qc0geu2',
        'qjvy4hr',
        'qkbcb6u',
        'qn59q441g',
        'r08cysh',
        'r207tp471',
        'rcgynxk',
        'rcofrgk',
        's28p4ir',
        's7526c98r',
        'sffnt1m',
        'sieyazl',
        'sj139301v',
        'st74cr668',
        't0xt4ls',
        'tb09j693r',
        'th83m023h',
        'torh4pp',
        'u1cnmj1',
        'u4pvoiq',
        'ukvpxbo',
        'uoeae9x',
        'ut99im9',
        'uwp76sh',
        'uye351l',
        'v405s9778',
        'v979v413n',
        'vh53ww37b',
        'vt150j93m',
        'vwn5gsm',
        'vzn1kaq',
        'w37637980',
        'wd375w35b',
        'we6qich',
        'whpeetf',
        'wkrtx7g',
        'wmlkiom',
        'wp988m09w',
        'ws3za03',
        'wsa6nnu',
        'wtl6m8z',
        'wxtwzjc',
        'x0sn5hu',
        'x633f153j',
        'x6rar31',
        'x70vejb',
        'x78peme',
        'xd07gs80t',
        'xd07gt25z',
        'xpej45y',
        'xw42n881j',
        'y11535o',
        'yasty4z',
        'yv8v2uh',
        'z029p529v',
        'z82jpz5',
        'zc3osyv',
        'zugqcua',
      ]

      items_needing_ocr = [args[:work_friendlier_id]] if args[:work_friendlier_id].present?

      total = items_needing_ocr.count
      progress_bar = ProgressBar.create(total: total, format: Kithe::STANDARD_PROGRESS_BAR_FORMAT)
      ocr_enqueued_count = 0
      Kithe::Indexable.index_with(batching: true) do
        items_needing_ocr.each do |work_id|
          work = Work.find_by_friendlier_id(work_id)

          if work.nil?
            progress_bar.log("Couldn't find work #{work_id}")
            next
          end


          if work.ocr_requested?
            progress_bar.log("SKIPPING: Already turned on for #{work_id}")
            progress_bar.increment
            next
          end
          
          work.ocr_requested = true
          work.save!
          WorkOcrCreatorRemoverJob.set(queue: "special_jobs").perform_later(work)
          puts "\nOCR enqueued for #{work_id}."
          ocr_enqueued_count += 1
          progress_bar.increment
        end
      end
      puts "\nOCR enqueued for #{ocr_enqueued_count} works"
    end
  end
end
